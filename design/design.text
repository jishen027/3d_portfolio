import React, { useState, useEffect, useRef } from 'react';

const App = () => {
  const mountRef = useRef(null);
  const [isLoaded, setIsLoaded] = useState(false);
  const [view, setView] = useState('home'); // 'home', 'about', 'projects', 'contact'

  // --- Three.js Script Loading ---
  useEffect(() => {
    if (window.THREE) {
      setIsLoaded(true);
      return;
    }
    const script = document.createElement('script');
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js";
    script.async = true;
    script.onload = () => setIsLoaded(true);
    document.head.appendChild(script);
  }, []);

  // --- Three.js Scene Setup ---
  useEffect(() => {
    if (!isLoaded || !mountRef.current) return;

    const THREE = window.THREE;
    let width = window.innerWidth;
    let height = window.innerHeight;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
    camera.position.z = 6;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    mountRef.current.appendChild(renderer.domElement);

    // --- Earth (Low Poly Tech Style) ---
    const earthGroup = new THREE.Group();
    const earthGeom = new THREE.IcosahedronGeometry(2, 2);
    const earthMat = new THREE.MeshPhysicalMaterial({
      color: 0xffffff,
      flatShading: true,
      metalness: 0,
      roughness: 0.2,
      transmission: 0.6,
      transparent: true,
      opacity: 0.4,
    });
    const earth = new THREE.Mesh(earthGeom, earthMat);
    const earthWireMat = new THREE.LineBasicMaterial({ color: 0x000000, transparent: true, opacity: 0.05 });
    const earthWire = new THREE.LineSegments(new THREE.WireframeGeometry(earthGeom), earthWireMat);
    
    earthGroup.add(earth);
    earthGroup.add(earthWire);
    scene.add(earthGroup);

    // --- Plane ---
    const planeGroup = new THREE.Group();
    const planeBodyGeom = new THREE.ConeGeometry(0.12, 0.5, 3);
    const planeMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const planeBody = new THREE.Mesh(planeBodyGeom, planeMat);
    planeBody.rotation.x = Math.PI / 2;
    const wingGeom = new THREE.BoxGeometry(0.7, 0.02, 0.15);
    const wing = new THREE.Mesh(wingGeom, planeMat);
    const planeModel = new THREE.Group();
    planeModel.add(planeBody);
    planeModel.add(wing);
    planeModel.position.x = 3.5; 
    planeGroup.add(planeModel);
    scene.add(planeGroup);

    // --- Lighting ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 5, 5);
    scene.add(dirLight);

    let mouseX = 0, mouseY = 0;
    const onMouseMove = (e) => {
      mouseX = (e.clientX / width) * 2 - 1;
      mouseY = -(e.clientY / height) * 2 + 1;
    };
    window.addEventListener('mousemove', onMouseMove);

    let animationId;
    const animate = () => {
      animationId = requestAnimationFrame(animate);
      earthGroup.rotation.y += 0.002;
      earthGroup.rotation.x += (mouseY * 0.1 - earthGroup.rotation.x) * 0.05;
      earthGroup.rotation.y += (mouseX * 0.1 - earthGroup.rotation.y) * 0.05;
      planeGroup.rotation.y += 0.012;
      planeGroup.rotation.z += 0.003;
      
      // Dynamic Scene Positioning based on View
      let targetX = 0;
      let targetScale = 1;
      let targetOpacity = 0.4;

      if (view === 'about') {
        targetX = -3;
        targetScale = 0.8;
      } else if (view === 'projects') {
        targetX = 4;
        targetScale = 1.2;
        targetOpacity = 0.15;
      } else if (view === 'contact') {
        targetX = 0;
        targetScale = 0.5;
        targetOpacity = 0.1;
      }

      earthGroup.position.x += (targetX - earthGroup.position.x) * 0.05;
      const currentScale = earthGroup.scale.x;
      earthGroup.scale.setScalar(currentScale + (targetScale - currentScale) * 0.05);
      earthMat.opacity += (targetOpacity - earthMat.opacity) * 0.05;
      
      renderer.render(scene, camera);
    };
    animate();

    const handleResize = () => {
      width = window.innerWidth;
      height = window.innerHeight;
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
    };
    window.addEventListener('resize', handleResize);

    return () => {
      window.removeEventListener('mousemove', onMouseMove);
      window.removeEventListener('resize', handleResize);
      cancelAnimationFrame(animationId);
      mountRef.current?.removeChild(renderer.domElement);
    };
  }, [isLoaded, view]);

  return (
    <div className="relative min-h-screen bg-[#F2F2F2] text-[#1A1A1A] font-sans selection:bg-black selection:text-white">
      
      {/* Background Grid */}
      <div className="fixed inset-0 z-0 opacity-[0.03] pointer-events-none" 
           style={{ backgroundImage: `linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)`, backgroundSize: '60px 60px' }}>
      </div>

      {/* Navigation */}
      <nav className="fixed top-0 left-0 w-full z-50 flex justify-between items-center px-8 md:px-16 py-10 bg-[#F2F2F2]/80 backdrop-blur-sm">
        <div 
          className="font-bold text-lg tracking-tighter uppercase cursor-pointer"
          onClick={() => setView('home')}
        >
          Jeb Lee
        </div>
        <div className="flex space-x-10 text-[10px] font-bold uppercase tracking-[0.3em]">
          <button onClick={() => setView('home')} className={`transition-opacity ${view === 'home' ? 'opacity-100' : 'opacity-30 hover:opacity-100'}`}>Home</button>
          <button onClick={() => setView('about')} className={`transition-opacity ${view === 'about' ? 'opacity-100' : 'opacity-30 hover:opacity-100'}`}>About</button>
          <button onClick={() => setView('projects')} className={`transition-opacity ${view === 'projects' ? 'opacity-100' : 'opacity-30 hover:opacity-100'}`}>Projects</button>
          <button onClick={() => setView('contact')} className={`transition-opacity ${view === 'contact' ? 'opacity-100' : 'opacity-30 hover:opacity-100'}`}>Contact</button>
        </div>
      </nav>

      {/* 3D Canvas Background */}
      <div ref={mountRef} className="fixed inset-0 z-0 pointer-events-none" />

      {/* VIEW: HOME */}
      {view === 'home' && (
        <div className="relative z-10 w-full h-screen p-10 flex flex-col justify-between pointer-events-none transition-all duration-1000 animate-in fade-in">
          <div className="flex justify-between items-start pt-16 md:pt-24 px-8">
            <div className="max-w-xs">
              <h1 className="text-5xl md:text-7xl font-bold tracking-tighter leading-none mb-4">
                CRAFTING<br/>NEW<br/>WORLDS.
              </h1>
            </div>
            <div className="hidden md:block text-right">
              <p className="font-mono text-[9px] uppercase tracking-widest opacity-40 mb-2">Core Competency</p>
              <p className="text-xs font-medium">3D Interaction / Cloud / Frontend</p>
            </div>
          </div>

          <div className="flex flex-col md:flex-row justify-between items-end pb-10 px-8">
            <div className="max-w-sm pointer-events-auto">
              <p className="text-xs md:text-sm font-light leading-relaxed mb-8 opacity-60">
                A Software Engineer specializing in the intersection of 3D art and functional code. Building digital experiences that defy flat constraints.
              </p>
              <button 
                onClick={() => setView('about')}
                className="px-8 py-4 bg-black text-white text-[10px] uppercase tracking-widest font-bold hover:bg-zinc-800 transition-all"
              >
                Learn More
              </button>
            </div>
            <div className="hidden md:block text-right">
              <div className="font-mono text-[10px] uppercase tracking-[0.5em] opacity-20 mb-4">EST. 2024 — PERSISTENT</div>
            </div>
          </div>
        </div>
      )}

      {/* VIEW: ABOUT */}
      {view === 'about' && (
        <div className="relative z-10 w-full min-h-screen pt-40 px-8 md:px-24 pb-24 transition-all duration-700 animate-in slide-in-from-bottom-12">
          
          <div className="grid md:grid-cols-2 gap-20 mb-32">
            <div>
              <p className="font-mono text-[10px] uppercase tracking-[0.4em] mb-6 opacity-40 text-black">[ Profile Overview ]</p>
              <h2 className="text-4xl md:text-6xl font-bold tracking-tighter leading-tight mb-8">
                Hello, I am <span className="text-transparent bg-clip-text bg-gradient-to-r from-black to-zinc-400">Jeb Lee.</span>
              </h2>
            </div>
            <div className="flex items-center">
              <p className="text-base md:text-lg font-light leading-relaxed text-zinc-600">
                Software Engineer with a passion for building web applications. I specialize in front-end development and have experience working with modern frameworks like <span className="text-black font-medium underline decoration-zinc-300">React and Next.js</span>. I am also familiar with back-end technologies like Node.js and Express, as well as cloud services like Docker, Kubernetes, and AWS.
              </p>
            </div>
          </div>

          <div className="mb-40">
            <div className="flex items-center gap-4 mb-12">
              <div className="h-[1px] w-12 bg-black"></div>
              <h3 className="font-mono text-xs uppercase tracking-[0.5em] font-bold">Tech Stack</h3>
            </div>
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-px bg-zinc-200 border border-zinc-200">
              {[
                "React", "Next.js", "TypeScript", "Tailwind CSS", "JavaScript", "HTML/CSS",
                "Node.js", "Express", "Redux", "Framer Motion", "MongoDB", "Git/GitHub",
                "AWS", "Docker", "Kubernetes"
              ].map(skill => (
                <div key={skill} className="bg-[#F2F2F2] p-8 aspect-square flex flex-col justify-center items-center group hover:bg-black transition-colors">
                  <span className="font-mono text-[10px] opacity-40 group-hover:opacity-100 group-hover:text-white mb-2 uppercase tracking-tighter">0{Math.floor(Math.random()*9)}</span>
                  <span className="text-xs font-bold uppercase tracking-widest text-center group-hover:text-white">{skill}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="max-w-4xl mx-auto">
            <div className="flex items-center gap-4 mb-16">
              <div className="h-[1px] w-12 bg-black"></div>
              <h3 className="font-mono text-xs uppercase tracking-[0.5em] font-bold">Experience</h3>
            </div>
            <div className="space-y-0">
              {[
                { role: "Cloud Application Developer", company: "Pyronix", date: "2024 June — Present", desc: "Developing and maintaining cloud applications for a leading provider of security solutions." },
                { role: "Software Developer", company: "Oasis Studio", date: "2022 October — 2024 June", desc: "Maintained web applications using React.js and related technologies." },
                { role: "Bsc Software Engineering", company: "Ajou University", date: "Mar 2015 — Feb 2020", desc: "Learned software design, development, and testing." }
              ].map((exp, i) => (
                <div key={i} className="relative pl-12 pb-20 group">
                  <div className="absolute left-[5px] top-2 bottom-0 w-[1px] bg-zinc-200 group-last:hidden"></div>
                  <div className="absolute left-0 top-2 w-[11px] h-[11px] bg-white border-2 border-black rounded-full z-10"></div>
                  <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <div>
                      <h4 className="text-xl font-bold tracking-tight">{exp.role}</h4>
                      <p className="text-sm font-medium opacity-40 uppercase tracking-widest">{exp.company}</p>
                    </div>
                    <div className="font-mono text-[10px] opacity-40 mt-2 md:mt-0 px-3 py-1 border border-zinc-200 rounded-full">{exp.date}</div>
                  </div>
                  <p className="text-sm font-light leading-relaxed text-zinc-500 max-w-2xl">{exp.desc}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* VIEW: PROJECTS */}
      {view === 'projects' && (
        <div className="relative z-10 w-full min-h-screen pt-40 px-8 md:px-24 pb-24 transition-all duration-700 animate-in slide-in-from-right-12">
          <div className="max-w-2xl mb-24">
            <p className="font-mono text-[10px] uppercase tracking-[0.4em] mb-6 opacity-40 text-black">[ Selected Works ]</p>
            <h2 className="text-5xl md:text-7xl font-bold tracking-tighter leading-tight mb-8">
              My <span className="text-transparent bg-clip-text bg-gradient-to-r from-black to-zinc-400">Projects.</span>
            </h2>
            <p className="text-zinc-500 font-light max-w-lg">
              A curated selection of applications focusing on creative interaction, robust cloud architecture, and intuitive user experiences.
            </p>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-px bg-zinc-200 border border-zinc-200">
            {[
              {
                title: "Prompt Not Found",
                desc: "Web application to share and discover ChatGPT prompts for creative activities.",
                tech: ["Next.js", "Tailwind", "OpenAI"],
                num: "01"
              },
              {
                title: "Evently",
                desc: "Online event booking platform for virtual and in-person events.",
                tech: ["React", "Stripe", "Clerk"],
                num: "02"
              },
              {
                title: "My Notes",
                desc: "Note-taking app that allows users to create, edit, and organize notes into categories.",
                tech: ["Node.js", "MongoDB", "Redux"],
                num: "03"
              }
            ].map(proj => (
              <div key={proj.title} className="bg-[#F2F2F2] p-10 flex flex-col justify-between group hover:bg-black transition-all duration-500 min-h-[400px]">
                <div>
                  <div className="flex justify-between items-start mb-12">
                    <span className="font-mono text-[10px] opacity-30 group-hover:text-white group-hover:opacity-100">{proj.num}</span>
                    <div className="w-8 h-8 flex items-center justify-center border border-zinc-300 group-hover:border-white transition-colors">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="group-hover:text-white"><path d="M7 17L17 7M17 7H7M17 7V17"/></svg>
                    </div>
                  </div>
                  <h3 className="text-2xl font-bold tracking-tight mb-4 group-hover:text-white">{proj.title}</h3>
                  <p className="text-sm font-light leading-relaxed text-zinc-500 group-hover:text-zinc-400 mb-8">{proj.desc}</p>
                </div>
                <div className="flex flex-wrap gap-2">
                  {proj.tech.map(t => (
                    <span key={t} className="text-[9px] font-mono uppercase tracking-widest px-2 py-1 border border-zinc-200 group-hover:border-zinc-700 group-hover:text-zinc-400">
                      {t}
                    </span>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* VIEW: CONTACT */}
      {view === 'contact' && (
        <div className="relative z-10 w-full min-h-screen pt-40 px-8 md:px-24 pb-24 transition-all duration-700 animate-in slide-in-from-bottom-12">
          <div className="grid lg:grid-cols-2 gap-24">
            <div>
              <p className="font-mono text-[10px] uppercase tracking-[0.4em] mb-6 opacity-40 text-black">[ Communication Protocol ]</p>
              <h2 className="text-5xl md:text-7xl font-bold tracking-tighter leading-tight mb-12">
                Get in <span className="text-transparent bg-clip-text bg-gradient-to-r from-black to-zinc-400">Touch.</span>
              </h2>
              
              <form className="space-y-8 max-w-md">
                <div className="space-y-2">
                  <label className="text-[10px] font-bold uppercase tracking-widest opacity-40">Name</label>
                  <input type="text" placeholder="Your Name" className="w-full bg-transparent border-b border-zinc-300 py-3 focus:outline-none focus:border-black transition-colors" />
                </div>
                <div className="space-y-2">
                  <label className="text-[10px] font-bold uppercase tracking-widest opacity-40">Email</label>
                  <input type="email" placeholder="Your Email" className="w-full bg-transparent border-b border-zinc-300 py-3 focus:outline-none focus:border-black transition-colors" />
                </div>
                <div className="space-y-2">
                  <label className="text-[10px] font-bold uppercase tracking-widest opacity-40">Message</label>
                  <textarea placeholder="Your Message" rows="4" className="w-full bg-transparent border-b border-zinc-300 py-3 focus:outline-none focus:border-black transition-colors resize-none"></textarea>
                </div>
                <button className="w-full py-5 bg-black text-white text-[10px] font-bold uppercase tracking-[0.4em] hover:bg-zinc-800 transition-all">
                  Send Message
                </button>
              </form>
            </div>

            <div className="flex flex-col justify-end lg:pb-24 lg:text-right">
              <div className="space-y-12">
                <div>
                  <h4 className="font-mono text-[10px] uppercase tracking-[0.3em] font-bold mb-4 opacity-30">Socials</h4>
                  <div className="flex lg:justify-end gap-8 text-sm font-medium">
                    <a href="#" className="hover:opacity-40 transition-opacity underline decoration-zinc-300">LinkedIn</a>
                    <a href="#" className="hover:opacity-40 transition-opacity underline decoration-zinc-300">GitHub</a>
                    <a href="#" className="hover:opacity-40 transition-opacity underline decoration-zinc-300">Twitter</a>
                  </div>
                </div>
                <div>
                  <h4 className="font-mono text-[10px] uppercase tracking-[0.3em] font-bold mb-4 opacity-30">Direct</h4>
                  <p className="text-xl font-bold tracking-tight">hello@jeb-lee.dev</p>
                </div>
                <div className="pt-12 border-t border-zinc-200">
                  <p className="text-[10px] font-mono uppercase tracking-[0.5em] opacity-20">Currently available for select freelance opportunities & collaborations.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Decorative Nodes (Persistent) */}
      <div className="fixed top-1/2 left-6 -translate-y-1/2 hidden lg:block opacity-20 z-20 pointer-events-none">
        <div className="h-32 w-[1px] bg-black mb-4 mx-auto"></div>
        <div className="font-mono text-[9px] uppercase tracking-widest [writing-mode:vertical-lr] rotate-180">
          {view === 'home' ? 'Origin Module' : view === 'projects' ? 'Asset Gallery' : 'Connection Hub'}
        </div>
      </div>
      
      <div className="fixed top-1/2 right-6 -translate-y-1/2 hidden lg:block opacity-20 z-20 pointer-events-none">
        <div className="font-mono text-[9px] uppercase tracking-widest [writing-mode:vertical-lr]">System Protocol 5.0</div>
        <div className="h-32 w-[1px] bg-black mt-4 mx-auto"></div>
      </div>

    </div>
  );
};

export default App;